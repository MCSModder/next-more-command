# 剧情对话指令

## 1 简介

剧情对话指令是剧情文本里使用的指令，该指令的设计是为了能更好的进行剧情编写以及在剧情文本中穿插命令。

## 2 基本格式

一条剧情指令的格式如下：

`指令名*参数一#参数二#参数三......`

而对话指令的指令名为 `Say` 与 ` `(空)
即可以省略不写，如

`Say*主角#你好。`

与

`*主角#你好。`

与

`主角#你好。`

这种写法是等价的。

## 3 指令查询表

**注：** 使用[&expression&]可以执行脚本并将返回值嵌入指令，请参考 [**运行时脚本**](运行时脚本.md)

| 指令                         | 说明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ---------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Nothing**                  | Nothing\*<br/><br/>空指令，什么也不做。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Print**                    | Print\*类型#打印内容<br/><br/>Print\*Info#Hello World<br/><br/>在日志窗口输出信息<br/>类型：<br/>Info 或 空：普通信息<br/>Warning：警告信息<br/>Error：错误信息                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **RunLua**                   | RunLua\*Lua 文件#Lua 函数<br/><br/>RunLua\*Test#T1<br/><br/>运行 Lua 函数，直到运行完毕后再进行下一个指令<br/>详情参考 [**Lua 脚本**](Lua脚本.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **Say<br/>(或空指令)**       | Say\*对话者#对话内容<br/><br/>Say\*主角#你好<br/>\*主角#你好<br />主角#你好<br/><br/>对话指令，用于显示一条对话。<br/>参数一：对话者，通过在剧情文件的`character`项里指定，或使用`SetChar`指令指定。<br/>参数二：对话内容，对话内容里的#号不会影响对话内容显示。<br/><br/>剧情对话中可以使用特殊文本，该部分可参考[**剧情对话特殊文本**](剧情对话特殊文本.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **SetChar**                  | SetChar\*对话者#设置值<br/><br/>SetChar\*主角#1<br />SetChar\*目标#[&roleID&]<br/><br/>设置对话者对应 ID<br/>参数一：对话者，设置的对话者将储存在全局的临时对话者字典里，可以跨剧情调用，但是重启游戏后将会丢失。<br/>参数二：设置值，对话者对应的角色 ID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **BindNpc**                  | BindNpc\*NPC 的 ID<br/><br/>BindNpc\*619<br/><br/>将目标角色绑定到环境变量之中，会自动绑定`bindNpc`、`roleBindID`、`roleID`、`roleName`变量                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **ShowOption**               | ShowOption\*选项 1ID:选项 1 内容:选项 1 条件(可选)#选项 2ID:选项 2 内容:选项 2 条件(可选)#......<br/><br/>ShowOption\*1:你好#2:再见#3:给我！:[&GetMoney()<100ul&]<br/><br/>选项指令，弹出选择框让玩家进行选择，选择后，脚本环境中`optionID`值将变为选项对应 ID 值。<br/>选项条件可不填，当不填或计算结果为 true 时选项显示。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **SayOption**                | SayOption\*对话者#对话内容#选项 1ID:选项 1 内容:选项 1 条件(可选)#选项 2ID:选项 2 内容:选项 2 条件(可选)#......<br/><br/>SayOption\*旁白#你好#1:你好#2:再见#3:给我！:[&GetMoney()<100ul&]<br/><br/>同`ShowOption`，但是会如同 Say 指令一样先显示对话内容。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **ShowCG**                   | ShowCG\*图片 ID<br/><br/>ShowCG\*back<br/>ShowCG\*pic1/cg<br/><br/>显示自定义对话背景，需要使用`HideCG`指令关闭背景。<br/>添加背景可参考 [运行时脚本](运行时脚本.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **HideCG**                   | HideCG\*<br/><br/>关闭 CG 背景                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **Event**                    | Event\*目标事件#跳转条件（可省略，或为 true 时跳转）<br/><br/>Event\*事件一<br/>Event\*事件一#[&roleBindID==609&]<br/><br/>当条件满足时，结束当前事件并跳转到指定事件。<br/><br/>参数一：目标事件<br/>~~参数二：跳转条件，可省略，当为空或为 true 时进行跳转。~~ **建议改用 If 指令**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **Trigger**                  | Trigger\*触发器 ID<br/><br/>Trigger\*某某宗门派对话<br/><br/>对指定触发器进行一次触发判断（无视触发器类型），若满足条件，则相当于使用 Event 指令进行事件跳转。<br/>处于关闭状态的触发器不会被触发。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **TriggerAll**               | TriggerAll\*触发器类型#是否全部触发（0 否，1 是，默认 1）<br/><br/>TriggerAll\*进入游戏\|EnterGame<br/>TriggerAll\*某某宗晋升金丹#1<br/><br/>对指定的触发器类型进行一次触发器判断，若触发成功则中断当前事件，并进入新事件。<br/>触发器类型：可指定多个触发器类型，之间用`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `符号分割。可使用自定义的触发器类型。<br/>是否全部触发：为 0 时只会触发第一个触发成功的触发器，为 1 时会将所有触发成功的触发器塞入队列。<br/>处于关闭状态的触发器不会被触发。 |
| **SetTrigger**               | SetTrigger\*触发器 ID#触发器状态（0 关闭，1 打开）<br/><br/>SetTrigger\*初入禁地#0<br/><br/>开启或关闭一个触发器。被关闭的触发器不会再参与触发判断。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **If**                       | If\*判断条件#其他指令<br/><br/>If\*[&roleBindID == 609&]#ChangeMoney\*100<br/>If\*[&roleBindID == 609&]#旁白#你好<br/><br/>当条件满足时，执行后续指令。<br/><br/>参数一：判断条件，使用[&condition&]进行表达式计算，当返回结果为 true 时跳转<br/>参数二：其他指令（按原指令填写即可）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **SetInt**                   | SetInt\*键#值<br/><br/>SetInt\*数值 1#10<br/>SetInt*数值 1#[&GetInt("数值 1") * 2&]<br/><br/>储存一个整形键值，该键值将储存于游戏存档里。<br/>取出值使用`GetInt(key)`进行取值。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **ChangeInt**                | ChangeInt\*键#变化值<br/><br/>ChangeInt\*数值 1#10<br/>ChangeInt*数值 1#[&GetInt("数值 1") * 2&]<br/><br/>修改储存的键值，该数值将在原数值上进行变动。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **SetStr**                   | SetStr\*键#值<br/><br/>SetStr\*字符串 1#你好<br/>SetStr\*字符串 1#[&GetStr("数值 1")&][&getstr("数值1")&]<br/><br/>储存一个字符串键值，该键值将储存于游戏存档里。<br/>取出值使用`GetStr(key)`进行取值。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **AddTime**                  | AddTime\*年#月#日#是否显示提示(0 否，1 是，默认不显示)#提示文本<br/><br/>AddTime\*10#0#0<br/>AddTime\*10#0#0#1#正在挖矿中...<br/><br/>使时间跳过对应的年月日，如果显示提示则会显示一个结算读条。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **ChangeHp**                 | ChangeHp\*血量变化量<br/><br/>ChangeHp\*1000<br/>ChangeHp\*-500<br/><br/>修改主角血量。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **ChangeBaseHpMax**          | ChangeBaseHpMax\*最大血量基础变化量<br/><br/>ChangeBaseHpMax\*1000<br/>ChangeBaseHpMax\*-500<br/><br/>修改主角基础最大血量。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **ChangeExp**                | ChangeExp\*修为变化量<br/><br/>ChangeExp\*1000<br/>ChangeExp\*-500<br/><br/>修改主角修为。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **ChangeMoney**              | ChangeMoney\*灵石变化量<br/><br/>ChangeMoney\*1000<br/>ChangeMoney\*-500<br/><br/>修改主角灵石数量。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **AddItem**                  | AddItem\*物品 ID#添加数量#是否显示提示（0 不显示，1 显示）<br/><br/>AddItem\*101#1#1<br/><br/>为主角添加物品。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **RemoveItem**               | RemoveItem\*物品 ID#移除数量#是否显示提示（0 不显示，1 显示）<br/><br/>RemoveItem\*101#1#1<br/><br/>为主角移除物品。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **UseItem**                  | UseItem\*物品 ID#是否消耗背包物品（0 否 1 是）<br/><br/>UseItem\*101<br/><br/>为主角使用物品。（如果是装备会自动装备）如果填写不消耗背包物品，会自动添加一个物品然后使用。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **AddNpcItem**               | AddNpcItem\*NpcID#物品 ID#添加数量<br/><br/>AddNpcItem\*609#101#1<br/><br/>为 Npc 添加物品。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **ChangeMentality**          | ChangeMentality\*心境变化量<br/><br/>ChangeMentality\*100<br/><br/>修改主角心境                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **ChangeDrugsPoison**        | ChangeDrugsPoison\*丹毒变化量<br/><br/>ChangeDrugsPoison\*100<br/><br/>修改主角丹毒                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **ChangeComprehensionPoint** | ChangeComprehensionPoint\*悟道点变化量<br/><br/>ChangeComprehensionPoint\*2<br/><br/>修改主角悟道点                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **AddThinking**              | AddThinking\*思绪 ID<br/><br/>AddThinking\*1<br/><br/>添加思绪                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **AddComprehensionExp**      | AddComprehensionExp\*道类型 ID#道经验<br/><br/>AddComprehensionExp\*8#100<br/><br/>增加剑道经验 100 点                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **AddCongenitalBuff**        | AddCongenitalBuff\*BuffID<br/><br/>AddCongenitalBuff\*1<br/><br/>添加一层先天 Buff                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **RemoveCongenitalBuff**     | RemoveCongenitalBuff\*BuffID<br/><br/>RemoveCongenitalBuff\*1<br/><br/>移除一层先天 Buff                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **ChangeInspiration**        | ChangeInspiration\*灵感变化量<br/><br/>ChangeInspiration\*100<br/><br/>修改主角灵感                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **ChangeAge**                | ChangeAge\*年龄变化量<br/><br/>ChangeAge\*10<br/><br/>修改主角年龄                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **ChangeLife**               | ChangeLife\*寿元变化量<br/><br/>ChangeLife\*10<br/><br/>修改主角寿元                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **ChangeTalent**             | ChangeTalent\*资质变化量<br/><br/>ChangeTalent\*10<br/><br/>修改主角资质                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **ChangeBaseSpirit**         | ChangeBaseSpirit\*基础神识变化量<br/><br/>ChangeBaseSpirit\*10<br/><br/>修改主角基础神识                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **ChangeAbility**            | ChangeAbility\*悟性变化量<br/><br/>ChangeAbility\*10<br/><br/>修改主角悟性                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **ChangeBaseMoveSpeed**      | ChangeBaseMoveSpeed\*基础遁速变化量<br/><br/>ChangeBaseMoveSpeed\*10<br/><br/>修改主角基础遁速                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **ChangeNpcFav**             | ChangeNpcFav\*Npc 的 ID#好感变化量#是否同时修改情分(1 是 0 否)#是否显示提示(1 是 0 否)<br/><br/>ChangeNpcFav\*609#200#1#1<br/><br/>修改与 Npc 的好感度                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **AddRelation**              | AddRelation\*Npc 的 ID#关系类型<br/><br/>AddRelation\*609#2<br/><br/>增加与 Npc 的关系<br/><br/>关系类型：<br/>0. 师傅<br/>1. 徒弟<br/>2. 道侣<br/>3. 结义                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **RemoveRelation**           | RemoveRelation\*Npc 的 ID#关系类型<br/><br/>RemoveRelation\*609#2<br/><br/>移除与 Npc 的关系<br/><br/>关系类型同增加关系指令                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **CloseTabUI**               | CloseTabUI\*<br/><br/>关闭背包 Tab 界面                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Death**                    | Death\*死亡类型<br/><br/>Death\*1<br/><br/>主角死亡<br/><br/>死亡类型：<br/>1.身死道消<br/>2.毒发身亡<br/>3.寿元已尽<br/>4.炉毁人亡<br/>5.器毁人亡<br/>6.心魔入体<br/>7.渡劫失败                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **Input**                    | Input\*提示文字<br/><br/>打开一个输入框，允许玩家输入文字。输入的文字将会储存在环境变量 `input` 中（详情查询 [运行时脚本](运行时脚本.md)）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **ShowTip**                  | ShowTip\*消息#消息图标<br/><br/>显示一条自定义的弹出消息。<br/><br/>消息图标类型：0:叹号,1:上箭头,2:下箭头,3:包裹,4:任务进度,5:任务完成,6:感悟,7:传音符,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **LearnSkill**               | LearnSkill\*神通 ID<br/><br/>LearnSkill\*1<br/><br/>直接学习对应神通。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **LearnStaticSkill**         | LearnStaticSkill\*功法 ID<br/><br/>LearnStaticSkill\*1<br/><br/>直接学习对应功法。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **LearnTrainSkill**          | LearnTrainSkill\*双修秘术 ID<br/><br/>LearnTrainSkill\*1<br/><br/>直接学习对应双修秘术。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **SetFace**                  | SetFace\*角色 ID#立绘 ID<br/><br/>SetFace\*1#10000<br/><br/>将指定角色的立绘设置为对应图片立绘。参考[添加资源](添加资源.md)<br/>主角的 ID 为 1<br/>将立绘 ID 设置为 0 表示还原立绘                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **SetCustomFace**            | SetCustomFace\*角色 ID#立绘 ID<br/><br/>SetFace\*1#614<br/><br/>将指定角色的立绘设置为对应捏脸立绘。<br/>主角的 ID 为 1<br/>该指令会优先获取自定义捏脸立绘，其次按人物 ID 获取对应人物的捏脸立绘                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **StartFight**               | StartFight\*敌人 ID#是否能逃跑（0 不能 1 能）#战斗类型#背景图片#背景音乐#敌方 Buff#我方 Buff#战斗胜利事件#战斗失败事件#战斗 Tag<br/><br/>StartFight\*5124#1#1#1#战斗 1###战斗胜利#战斗失败#野外战斗<br/><br/>战斗类型（具体定义可参考 战斗类型 表）：<br/>1,普通战斗<br/>2,心魔<br/>3,渡劫<br/>4,擂台<br/>5,幻境<br/>6,boss 战<br/>7,敌方逃离普通<br/>8,切磋<br/>9,新手引导<br/>10,神仙斗法<br/>12,长老战<br/>13,不杀对手<br/>16,古树根须<br/>17,生死比试<br/>20,无装备无丹药擂台<br/><br/>背景图片：使用数字命名，添加自定义背景可参考 [添加资源](添加资源.md)<br/><br/>背景音乐：使用字符串命名，添加自定义音乐可参考 [添加资源](添加资源.md)<br/><br/>敌方 Buff 与 我方 Buff：<br/>使用 buffID,buff 层数 的方式指定战斗 buff<br/>多个 buff 使用 \| 号分割。如：1,1\|2,1<br/><br/>战斗胜利事件 与 战斗失败事件：<br/>在战斗结束后，会根据战斗结果触发对应的事件（注：如果战斗类型没有玩家不死亡的设定，则战斗失败会直接死亡。）<br/><br/>战斗 Tag：<br/>Tag 用于战斗中事件的判断，填写多个 Tag 使用逗号","进行分割，如：TagA,TagB,TagC |
| **PlayMusic**                | PlayMusic\*音乐名称<br/><br/>PlayMusic\*战斗 1<br/><br/>添加自定义音乐可参考 [添加资源](添加资源.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **PlayEffect**               | PlayEffect\*音效名称#音调<br/><br/>PlayMusic\*点击#1.0<br/><br/>添加自定义音效可参考 [添加资源](添加资源.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **SendMsg**                  | SendMsg\*消息 ID<br/><br/>SendMsg\*1<br/><br/>向玩家发送传音符消息                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **RunFungusBlock**           | RunFungusBlock\*Block 名称<br/><br/>RunFungusBlock\*结束交谈<br/><br/>调用当前环境内 flowchart 的对应 Block（用于对话返回等）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
